pero si el cliente guarda mas tipo de elemento con piezas y peso por pieza nuevo, ya no se logra ver esa nueva tabla junto con el que se guardó anteriormente, lo que deseo es que el cliente vaya viendo los cambios que se han guardado asi para que tenga conocimiento de lo que guardó

-se necesita hacer que cada hoja creada en excel tenga un nombre porque al descargar el documento me sale el nomnre
por defecto de worksheet,worksheet1, por ejemplo el documento tiene 2 hojas una de usuario y otra de documentos entonces necesito que tengan nombre
- me sigue saliendo el nombre de las hojas worksheet,worksheet1 y no aparecen las que yo puse
este es mi codigo
<?php
namespace App\Exports;

use Illuminate\Support\Collection;
use Maatwebsite\Excel\Concerns\FromCollection;
use Maatwebsite\Excel\Concerns\WithHeadings;
use Maatwebsite\Excel\Concerns\ShouldAutoSize;
use Maatwebsite\Excel\Concerns\WithMultipleSheets;

class UsuariosExport implements WithMultipleSheets
{
    protected $data;

    public function __construct($data)
    {
        $this->data = $data;
    }

    public function sheets(): array
    {
        $sheets = [
            new UsuariosSheet($this->data['usuarios']),
            new ClientesSheet($this->data['clientes']),
        ];

        return $sheets;
    }

}


class UsuariosSheet implements FromCollection, WithHeadings, ShouldAutoSize
{
    protected $usuarios;
    protected $title = 'Usuarios';

    public function __construct($usuarios)
    {
        $this->usuarios = $usuarios;
    }

    public function headings(): array
    {
        return [
            'id_usuario',
            'nombre_usuario',
            'apellido_paterno',
            'apellido_materno',
            'telefono',
            'correo_electronico',
            'contrasenia',
            'rol',
            'estado',
        ];
    }

    public function collection()
    {
        return collect($this->usuarios);
    }

    public function setTitle(string $title): self
    {
        $this->title = $title;
        return $this;
    }
    
    public function title(): string
    {
        return $this->title;
    }
}

class ClientesSheet implements FromCollection, WithHeadings, ShouldAutoSize
{
    protected $clientes;
    protected $title = 'Clientes';

    public function __construct($clientes)
    {
        $this->clientes = $clientes;
    }

    public function headings(): array
    {
        return [
            'id_cliente',
            'id_personaAutorizada',
            'nombre_cliente',
            'domicilio',
            'correo_electronico',
        ];
    }

    public function collection()
    {
        return collect($this->clientes);
    }

     public function setTitle(string $title): self
     {
         $this->title = $title;
         return $this;
     }
 
     public function title(): string
     {
         return $this->title;
     }
}


mi DocumentoController
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Usuario;
use App\Models\Cliente;
use Illuminate\Support\Facades\Session; // Agrega esta línea

class DocumentoController extends Controller
{
    public function exportarUsuario($id_usuario)
{
    $usuario = Usuario::findOrFail($id_usuario); // Obtén el usuario por su ID
    $cliente = Cliente::findOrFail($id_usuario); 



    // Combina los usuarios y clientes en un solo array
    $data = [
        'usuarios' => [$usuario],
        'clientes' => [$cliente],

    ];

    // Crear un objeto de exportación que incluya múltiples hojas
    $export = new UsuariosExport($data);
    // Configura los nombres de las hojas
    $export->sheets()[0]->setTitle('Usuarios');
    $export->sheets()[1]->setTitle('Clientes');
    
    // Generar y descargar el archivo Excel
    return Excel::download($export, 'documento.xlsx');
}
    
}

El error que estás viendo es un error de violación de la integridad referencial en una base de datos. El mensaje indica que estás tratando de insertar o actualizar una fila en la tabla Infraestructura_cfe, pero la operación viola la restricción de clave externa (foreign key constraint) definida en esa tabla.

La clave externa en cuestión es id_cliente, y está referenciando la columna id_cliente en la tabla cliente. Según el error, parece que estás tratando de insertar una fila en Infraestructura_cfe con un valor en id_cliente que no existe en la tabla cliente.

Aquí hay algunas cosas que puedes verificar y corregir:

Existencia del valor en id_cliente: Asegúrate de que el valor que estás intentando insertar en la columna id_cliente en la tabla Infraestructura_cfe ya existe en la columna correspondiente en la tabla cliente. En este caso, parece que estás tratando de insertar el valor 1 en id_cliente, así que verifica que existe un registro con id_cliente igual a 1 en la tabla cliente.

Orden de inserción: Si estás insertando datos en ambas tablas (cliente y Infraestructura_cfe), asegúrate de que primero insertas el valor en la tabla cliente antes de intentar insertar la fila correspondiente en la tabla Infraestructura_cfe.

Valores coincidentes: Asegúrate de que los valores que estás insertando en la columna id_cliente en la tabla Infraestructura_cfe sean del mismo tipo y coincidan con los valores en la columna correspondiente en la tabla cliente.

Integridad referencial: Verifica que la relación entre las tablas esté definida correctamente. En este caso, asegúrate de que todos los valores en la columna id_cliente de la tabla Infraestructura_cfe existan en la columna correspondiente de la tabla cliente.

Después de revisar estos puntos, deberías poder identificar y corregir la causa del error.





Message ChatGPT…

ChatGPT can make mi